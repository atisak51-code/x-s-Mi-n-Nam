<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Lottery Demo - Bangkok Time</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    table { border-collapse: collapse; margin: 20px auto; font-size: 24px; }
    td { border: 1px solid #444; padding: 10px 20px; text-align: center; }
    .spinner::after {
      content: "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô...";
      display: block;
      font-size: 14px;
      color: red;
      margin-top: 5px;
    }
    .final { font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h2>üé∞ Lottery Demo (Bangkok Time)</h2>
  <p>‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏≠‡∏¥‡∏á‡πÄ‡∏ß‡∏•‡∏≤ <b>‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (Asia/Bangkok)</b></p>

  <table>
    <tr>
      <!-- ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô 1-2 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö -->
      <td class="spin final"
          data-start="20:22:00"
          data-stop="20:23:00"
          data-duration="10"
          data-final="123456"
          data-length="6"></td>
    </tr>
  </table>

  <script>
    // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô Bangkok
    function nowInBangkok() {
      let now = new Date();
      let str = now.toLocaleString("en-US", { timeZone: "Asia/Bangkok" });
      return new Date(str);
    }

    // parse "HH:MM:SS" ‡πÄ‡∏õ‡πá‡∏ô Date ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (Bangkok timezone)
    function parseTimeBangkok(t) {
      let [h, m, s] = t.split(":").map(Number);
      let now = nowInBangkok();
      let d = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, s);
      if (d < now) {
        d.setDate(d.getDate() + 1); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      }
      return d;
    }

    function randomNumber(length) {
      let s = "";
      for (let i = 0; i < length; i++) {
        s += Math.floor(Math.random() * 10);
      }
      return s;
    }

    function showSpinner(cell) {
      cell.classList.add("spinner");
      cell.textContent = "";
    }

    function scheduleSpin(cell) {
      let startTime = cell.dataset.start;
      let stopTime = cell.dataset.stop;
      let duration = parseInt(cell.dataset.duration || 20);
      let finalNum = cell.dataset.final;
      let length = parseInt(cell.dataset.length || (finalNum ? finalNum.length : 2));

      let startDate = parseTimeBangkok(startTime);
      let stopDate = parseTimeBangkok(stopTime);
      let now = nowInBangkok();

      console.log("‚è∞ Now:", now.toLocaleTimeString(),
                  "Start:", startDate.toLocaleTimeString(),
                  "Stop:", stopDate.toLocaleTimeString());

      function startRandom() {
        cell.classList.remove("spinner");
        cell.innerHTML = "";
        let endTime = Date.now() + duration * 1000;
        let timer = setInterval(() => {
          let rand = randomNumber(length);
          cell.textContent = rand;

          if (Date.now() >= endTime) {
            clearInterval(timer);
            if (finalNum) {
              cell.textContent = finalNum;
            } else {
              cell.dataset.final = cell.textContent;
            }
            cell.classList.add("final");
          }
        }, 100);
      }

      if (now < startDate) {
        cell.textContent = finalNum || "";
        setTimeout(() => {
          showSpinner(cell);
          setTimeout(startRandom, duration * 1000);
        }, startDate - now);

      } else if (now >= startDate && now < stopDate) {
        showSpinner(cell);
        setTimeout(startRandom, duration * 1000);

      } else {
        cell.textContent = finalNum || "";
        cell.classList.add("final");
      }
    }

    document.querySelectorAll(".spin").forEach(scheduleSpin);
  </script>
</body>
</html>
